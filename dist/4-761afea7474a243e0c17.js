(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{111:function(e,t,n){var r,i,o,s,c,a,l,u,d;i=n(1),d=n(79),n(12),n(56),n(65),n(42),n(39),c=i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),u=new d.Parser({explicitArray:!1,async:!1}),r.reply("get-xmlparser",function(){return u}),a=class extends i.Model{},l=function(){class e extends i.Collection{}return e.prototype.model=a,e}.call(this),o=new l,r.reply("set-comics",function(e){return o.set(e)}),r.reply("get-comics",function(){return o}),s=new l,r.reply("set-all-comics",function(e){return s.set(e)}),r.reply("get-all-comics",function(){return s}),r.reply("parse-all-comics-xml",function(e,t){return u.parseString(e,function(e,n){var i;return(null!=(i=n.comicinfo.comiclist.comic)?i.length:void 0)||(console.warn("Single comic!"),i=[i]),r.request("set-all-comics",forsale),t()})}),r.reply("parse-comics-for-sale",function(e,t){return u.parseString(e,function(e,n){var i,o,s,a,l,u,d,p,h,f;for((null!=(s=n.comicinfo.comiclist.comic)?s.length:void 0)||(s=[s]),a=[],u=[],i=[],l=0,d=s.length;l<d;l++)"For Sale"===(f=(o=s[l]).collectionstatus._)?o.links?a.push(o):i.push(o):"In Collection"===f?u.push(o):(h=`Cannot determine comic status of (${`${(p=o.mainsection).series.displayname} #${p.issue}`})!`,c.request("danger",h));return u.length&&(h=`${u.length} ignored!!`,c.request("warning",h)),a.length||c.request("danger","No comics for sale!"),i.length&&(h=`There was some bad xml, skipped ${i.length} comics.`,c.request("danger",h)),r.request("set-comics",a),t()})}),r.reply("parse-comics-xml",function(e,t){return u.parseString(e,function(e,n){var i;return(null!=(i=n.comicinfo.comiclist.comic)?i.length:void 0)||(i=[i]),r.request("set-comics",i),t()})}),e.exports={}},112:function(e,t,n){var r,i,o,s,c,a=[].indexOf;r=n(1),o=n(65),s=n(42),i=r.Radio.channel("messages"),r.Radio.channel("ebcsv"),c=function(e,t){var n,r,c,l,u;return t.comic,r=t.desc,(u=o.compile(r.get("title"))(t)).length>80&&(c="Title too long.\n",c+=`${u} ----\x3e ${l=u.substring(0,79)}`,i.request("danger",c),u=l),e.Title=u,n=o.compile(r.get("content"))(t),(n=(n=(n=s(n)).split("\r").join("")).split("\n").join("")).length>32700&&(c=`${n.length} characters in description`,i.request("warning",c)),a.call(n,"\n")>=0&&i.request("danger","newline in description"),e.Description=n},e.exports=c},113:function(e,t,n){var r,i,o;i=n(1),n(86),i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),o=function(e,t){var n,i,o;return n=t.comic,o=r.request("get-comic-image-urls"),i=n.links.link.url,t.image_src=o[i].replace("http://","//"),e.PicURL=o[n.links.link.url]},e.exports=o},114:function(e,t,n){var r,i,o,s,c;(i=n(1)).Radio.channel("messages"),r=i.Radio.channel("ebcsv"),o={platinum:{start:1897,end:1937},golden:{start:1938,end:1955},silver:{start:1956,end:1969},bronze:{start:1970,end:1983},copper:{start:1984,end:1991},modern:{start:1992,end:2100}},s=function(e){var t,n;for(n in o)if(e>=(t=o[n]).start&&e<=t.end)return n;return!1},r.reply("get-comic-ages",function(){return o}),r.reply("find-age",function(e){return s(e)}),c=function(e,t){var n,r;return n=s(e),r=[],t.forEach(function(e){if(e.age===n)return r.push(e)}),r},r.reply("get-heroes-by-age",function(e,t){return c(e,t)}),e.exports={}},115:function(e,t,n){var r,i,o,s;i=n(1),n(86),n(114),o=i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),s=function(e,t){var n,i,s,c,a,l,u,d,p,h,f,g,v,m;for(i=t.comic,l=r.request("get-superheroes-model").get("rows"),(m=null!=(g=i.publicationdate)?g.year:void 0)||(m=i.releasedate.year,console.warn("Using releasedate")),m||(console.warn("Bad date for comic",i),o.request("danger",`Bad Date for comic ${i.id}`)),m=parseInt(m.displayname),v=i.mainsection.series.displayname.toLowerCase(),n=r.request("find-age",m),f=void 0,a={},p=0,h=(d=r.request("get-heroes-by-age",m,l)).length;p<h;p++)(u=d[p]).superhero.startsWith("Other ")&&(f=u),a[u.superhero.toLowerCase()]=u;for(c in null==f&&o.request("danger",`No category found for ${n}`),s=f,a)if(v.indexOf(c)>=0){s=a[c];break}return e["*Category"]=s.id},e.exports=s},116:function(e,t){var n;n=function(e,t){var n,r;if(null!=(n=t.comic)?n.isbn:void 0)return 14===(r=n.isbn).length&&(r=r.substring(0,r.length-2)),13===r.length&&(r=r.substring(1,r.length)),e["Product:UPC"]=r},e.exports=n},117:function(e,t,n){var r,i,o;i=n(12),r=n(56),o=function(e,t){var n,o,s,c;return(c=i(e.scheduletime))?(o=(new Date).valueOf()+c,n=new Date(o),s="yyyy-mm-dd HH:MM:ss",e.scheduletime=r(n,s)):e.scheduletime=""},e.exports=o},118:function(e,t){var n;n=function(e,t){var n,r;if(null!=(n=t.comic)?n.currentprice:void 0){for(r=n.currentprice;r.startsWith("$");)r=r.substring(1,r.length);return e.startprice=r}},e.exports=n},119:function(e,t,n){var r,i,o,s,c,a,l,u;i=n(1),n(79),n(12),n(56),n(65),n(42),l=n(39).default,i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),s=["Title","PicURL","Description","Product:EAN","Product:UPC","Product:ISBN","*Category"],a=["format","location","returnsacceptedoption","duration","quantity","startprice","dispatchtimemax","conditionid"],r.reply("csv-req-fieldnames",function(){return a}),c=["postalcode","paymentprofilename","returnprofilename","shippingprofilename","scheduletime"],r.reply("csv-opt-fieldnames",function(){return c}),u=function(){var e,t,n,r,i,o,u,d;for(t={action:"*Action"},n=0,o=a.length;n<o;n++)t[e=a[n]]=`*${l(e)}`;for(r=0,u=c.length;r<u;r++)t[e=c[r]]=e;for(i=0,d=s.length;i<d;i++)t[e=s[i]]=e;return t},r.reply("create-csv-header",function(){return create-csv-header()}),o=u(),r.reply("get-csv-header",function(){return o}),r.reply("grouped-csv-fields",function(){return{ReqFieldNames:a,OptFieldNames:c,EbayFields:s}}),e.exports={}},128:function(e,t){},130:function(e,t){},136:function(e,t,n){var r,i,o,s,c,a,l,u,d,p,h;i=n(1),n(79),n(12),n(56),n(65),n(42),n(39),n(119),p=n(118),d=n(117),u=n(116),a=n(115),l=n(113),h=n(112),i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),c=r.request("grouped-csv-fields"),o=function(e){var t,n;return n={},t=e.cfg.get("content"),n.action=e.action,c.ReqFieldNames.forEach(function(e){return n[e]=t[e]}),c.OptFieldNames.forEach(function(e){return n[e]=t[e]}),c.EbayFields.forEach(function(e){return n[e]=""}),n},s=function(e){var t,n,r;return t=e.comic,e.cfg.get("content"),(r=o(e)).quantity!==t.quantity&&(r.quantity=t.quantity),p(r,e),d(r,e),u(r,e),a(r,e),l(r,e),(null!=(n=t.mainsection)?n.plot:void 0)&&(t.mainsection.plot=t.mainsection.plot.split("<br>").join("\n"),t.mainsection.plot=t.mainsection.plot.split("<BR>").join("\n")),h(r,e),r},r.reply("create-csv-row-object",function(e){return s(e)}),e.exports={}},137:function(e,t,n){n(136),n(111)},140:function(e,t,n){"use strict";n.r(t);var r,i,o,s,c,a,l,u,d,p,h,f,g,v,m=n(3),w=n.n(m),y=n(1),b=n.n(y);n(139),n(138);r=b.a.Radio.channel("ebcsv"),s=class extends b.a.Model{initialize(){return this.fetch(),this.on("change",this.save,this)}fetch(){return this.set(JSON.parse(localStorage.getItem(this.id)))}save(e,t){return localStorage.setItem(this.id,JSON.stringify(this.toJSON())),w.a.ajax({success:t.success,error:t.error})}destroy(e){return localStorage.removeItem(this.id)}isEmpty(){return _.size(this.attributes<=1)}},h=new b.a.LocalStorage("configs"),f=new b.a.LocalStorage("descriptions"),c=function(){class e extends b.a.Model{}return e.prototype.localStorage=h,e.prototype.sync=b.a.LocalStorage.sync,e}.call(this),a=function(){class e extends b.a.Collection{}return e.prototype.localStorage=h,e.prototype.model=c,e.prototype.sync=b.a.LocalStorage.sync,e}.call(this),u=function(){class e extends b.a.Model{}return e.prototype.localStorage=f,e.prototype.sync=b.a.LocalStorage.sync,e}.call(this),l=function(){class e extends b.a.Collection{}return e.prototype.localStorage=f,e.prototype.model=u,e.prototype.sync=b.a.LocalStorage.sync,e}.call(this),g=new a,v=new l,r.reply("get_local_configs",function(){return g}),r.reply("get_local_descriptions",function(){return v}),p=["format","location","returnsacceptedoption","duration","quantity","startprice","dispatchtimemax","conditionid"],r.reply("csv-req-fieldnames-local",function(){return p}),d=["postalcode","paymentprofilename","returnprofilename","shippingprofilename","scheduletime"],r.reply("csv-opt-fieldnames-local",function(){return d}),o=class extends s{},function(){class e extends o{}return e.prototype.fieldType="required",e.prototype.fieldNames=p,e}.call(this),function(){class e extends o{}return e.prototype.fieldType="optional",e.prototype.fieldNames=d,e}.call(this),r.reply("get-comic-image-urls",function(){return new s({id:"comic-image-urls"}).toJSON()}),r.reply("add-comic-image-url",function(e,t){return new s({id:"comic-image-urls"}).set(e,t)}),r.reply("clear-comic-image-urls",function(){var e;return(e=new s({id:"comic-image-urls"})).destroy(),console.log("localStorage",localStorage[e.id])}),i={},r.reply("applet:local:get",function(e){return i[e]}),r.reply("applet:local:set",function(e,t){return i[e]=t}),r.reply("applet:local:delete",function(e){return delete i[e]}),r.reply("set-current-csv-action",function(e){return r.request("applet:local:set","currentCsvAction",e)}),r.reply("get-current-csv-action",function(){return r.request("applet:local:get","currentCsvAction")}),r.reply("set-current-csv-cfg",function(e){return r.request("applet:local:set","currentCsvCfg",e)}),r.reply("get-current-csv-cfg",function(){return r.request("applet:local:get","currentCsvCfg")}),r.reply("set-current-csv-dsc",function(e){return r.request("applet:local:set","currentCsvDsc",e)}),r.reply("get-current-csv-dsc",function(){return r.request("applet:local:get","currentCsvDsc")})},35:function(e,t,n){"use strict";n.r(t);var r,i,o,s,c=n(1),a=n.n(c),l=n(2),u=n.n(l),d=n(63),p=(n(3),n(0)),h=n.n(p),f=n(12),g=n.n(f),v=n(64),m=n(51),w=n(50),y=n(11),b=n(45),_=n(85),C=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};({MainController:r}=n(62)),a.a.Radio.channel("global"),i=a.a.Radio.channel("messages"),a.a.Radio.channel("resources"),function(){class e extends a.a.Marionette.View{regions(){var e;return(e=new w.a({el:"#main-content"})).slide_speed=g()(".01s"),{content:e,toolbar:"#main-toolbar"}}}return e.prototype.behaviors={ShowInitialEmptyContent:{behaviorClass:m.a}},e.prototype.template=h.a.renderable(function(e){return h.a.div(".col-sm-12",function(){return h.a.div(".row",function(){return h.a.div("#main-toolbar.col-sm-10.col-sm-offset-1")}),h.a.div(".row",function(){return h.a.div("#main-content.col-sm-10.col-sm-offset-1")})})}),e}.call(this),s=new a.a.Collection([]),_.a.reply("get-toolbar-entries",function(){return s}),o="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",function(){class e extends v.default{}return e.prototype.options={entryTemplate:h.a.renderable(function(e){var t;return t={style:o},h.a.span(t,function(){return h.a.i(e.icon),h.a.text(" "),h.a.text(e.label)})})},e}.call(this);var q,x,R,N=class e extends r{constructor(){super(...arguments),this._showMainView=this._showMainView.bind(this),this._show_create_csv_view=this._show_create_csv_view.bind(this),this._show_preview_csv_view=this._show_preview_csv_view.bind(this),this.create_csv=this.create_csv.bind(this)}_showMainView(){return C(this,e),Promise.all([n.e(6),n.e(8),n.e(24)]).then((()=>{var e,t;return e=_.a.request("get-comics"),t=new(n(160))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_show_create_csv_view(){return C(this,e),Promise.all([n.e(6),n.e(8),n.e(23)]).then((()=>{var e,t;return e=_.a.request("get-comics"),t=new(n(159))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_show_preview_csv_view(){return C(this,e),Promise.all([n.e(6),n.e(22)]).then((()=>{var e,t;return e=_.a.request("get-comics"),t=new(n(158))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_needComicsView(e){return _.a.request("get-comics").length?e():Object(y.default)("#ebcsv/xml/upload")}create_csv(){var t,n;return C(this,e),this.setupLayoutIfNeeded(),t=_.a.request("get_local_configs"),n=_.a.request("get_local_descriptions"),t.fetch().then(()=>n.fetch().then(()=>this._needComicsView(this._show_create_csv_view)))}preview_csv(){var e,t,n;if(this.setupLayoutIfNeeded(),e=_.a.request("get-current-csv-cfg"),t=_.a.request("get-current-csv-dsc"),n=_.a.request("get-superheroes-model"),void 0!==e)return e.fetch().then(()=>t.fetch().then(()=>n.fetch().then(()=>this._needComicsView(this._show_preview_csv_view))));Object(y.default)("#ebcsv")}main_view(){return this.setupLayoutIfNeeded(),this._needComicsView(this._showMainView)}upload_xml(){return this.setupLayoutIfNeeded(),Promise.all([n.e(6),n.e(21)]).then((()=>{var e,t;return e=_.a.request("get-comics"),t=new(n(157))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}view_cached_comics(){return this.setupLayoutIfNeeded(),Promise.all([n.e(6),n.e(20)]).then((()=>{var e;return e=new(n(156)),this.layout.showChildView("content",e)}).bind(null,n)).catch(n.oe)}list_configs(){return this.setupLayoutIfNeeded(),n.e(19).then((()=>{var e;return(e=_.a.request("get_local_configs")).fetch().done(()=>{var t;return t=new(n(155))({collection:e}),this.layout.showChildView("content",t)})}).bind(null,n)).catch(n.oe)}add_new_config(){return this.setupLayoutIfNeeded(),_.a.request("get_local_configs"),Promise.all([n.e(5),n.e(10)]).then((()=>{var e;return e=new(n(154).NewFormView),this.layout.showChildView("content",e),Object(b.a)()}).bind(null,n)).catch(n.oe)}view_config(e){return this.setupLayoutIfNeeded(),Promise.all([n.e(5),n.e(18)]).then((()=>{var t,r,i,o;return t=n(153),i=(r=_.a.request("get_local_configs")).get(e),console.log("view_config",i,r),o=new t({model:i}),this.layout.showChildView("content",o),Object(b.a)()}).bind(null,n)).catch(n.oe)}edit_config(e){return this.setupLayoutIfNeeded(),Promise.all([n.e(5),n.e(10)]).then((()=>{var t,r,i;return t=n(154),r=_.a.request("get_local_configs").get(e),i=new t.EditFormView({model:r}),this.layout.showChildView("content",i)}).bind(null,n)).catch(n.oe)}list_descriptions(){return this.setupLayoutIfNeeded(),n.e(17).then((()=>{var e,t;return(t=(e=_.a.request("get_local_descriptions")).fetch()).done(()=>{var t;return t=new(n(152))({collection:e}),this.layout.showChildView("content",t)}),t.fail(function(){return i.request("danger","Failed to get descriptions")})}).bind(null,n)).catch(n.oe)}add_new_description(){return this.setupLayoutIfNeeded(),Promise.all([n.e(5),n.e(7),n.e(9)]).then((()=>{var e;return e=new(n(151).NewFormView),this.layout.showChildView("content",e),Object(b.a)()}).bind(null,n)).catch(n.oe)}view_description(e){var t;return this.setupLayoutIfNeeded(),t=_.a.request("get_local_descriptions"),n.e(16).then((()=>{var r;return r=new(n(150))({model:t.get(e)}),this.layout.showChildView("content",r),Object(b.a)()}).bind(null,n)).catch(n.oe)}edit_description(e){var t;return this.setupLayoutIfNeeded(),t=_.a.request("get_local_descriptions"),Promise.all([n.e(5),n.e(7),n.e(9)]).then((()=>{var r,i,o;return r=n(151),i=t.get(e),o=new r.EditFormView({model:i}),this.layout.showChildView("content",o)}).bind(null,n)).catch(n.oe)}};n(140),n(137),a.a.Radio.channel("global"),a.a.Radio.channel("resources"),R=[{id:"main",label:"Main View",url:"#ebcsv",icon:".fa.fa-eye"},{id:"cfglist",label:"Configs",url:"#ebcsv/configs/list",icon:".fa.fa-list"},{id:"dsclist",label:"Descriptions",url:"#ebcsv/descriptions/list",icon:".fa.fa-list"},{id:"uploadxml",label:"Upload CLZ/XML",url:"#ebcsv/xml/upload",icon:".fa.fa-upload"},{id:"mkcsv",label:"Create CSV",url:"#ebcsv/csv/create",icon:".fa.fa-cubes"},{id:"cached",label:"Cached Images",url:"#ebcsv/clzpage",icon:".fa.fa-image"},{id:"addcfg",label:"Create Cfg",url:"#ebcsv/configs/add",icon:".fa.fa-plus"}],x=function(){class e extends u.a.AppRouter{}return e.prototype.appRoutes={ebcsv:"main_view","ebcsv/xml/upload":"upload_xml","ebcsv/csv/create":"create_csv","ebcsv/csv/preview":"preview_csv","ebcsv/clzpage":"view_cached_comics","ebcsv/configs":"list_configs","ebcsv/configs/list":"list_configs","ebcsv/configs/add":"add_new_config","ebcsv/configs/view/:name":"view_config","ebcsv/configs/edit/:name":"edit_config","ebcsv/descriptions":"list_descriptions","ebcsv/descriptions/list":"list_descriptions","ebcsv/descriptions/add":"add_new_description","ebcsv/descriptions/view/:name":"view_description","ebcsv/descriptions/edit/:name":"edit_description"},e}.call(this),q=function(){class e extends d.a{}return e.prototype.Controller=N,e.prototype.Router=x,e.prototype.appletEntries=[{label:"Ebcsv Menu",menu:R},{id:"addcfg",label:"Create Cfg",url:"#ebcsv/configs/add",icon:".fa.fa-plus"},{id:"adddsc",label:"Create Description",url:"#ebcsv/descriptions/add",icon:".fa.fa-plus"}],e.prototype.state={currentCsvAction:void 0,currentCsvConfig:void 0,currentCsvDsc:void 0},e}.call(this);t.default=q},85:function(e,t,n){"use strict";var r=n(1),i=n.n(r);n(2);t.a=i.a.Radio.channel("ebcsv")},86:function(e,t,n){"use strict";n.r(t);var r,i,o=n(1),s=n.n(o),c=n(85);s.a.Radio.channel("global"),r=function(){class e extends s.a.Model{}return e.prototype.url="/assets/data/superheroes.json",e}.call(this),i=new r,c.a.reply("get-superheroes-model",function(){return i})}}]);