(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{149:function(e,t,r){var a,s,o,n,l,i;a=r(0),r(2),i=r(1),a.Radio.channel("bumblr"),l=i.renderable(function(e){return i.p("main bumblr view")}),n=i.renderable(function(e){return i.p("bumblr_dashboard_view")}),o=function(){class e extends a.Marionette.View{}return e.prototype.template=l,e}.call(this),s=function(){class e extends a.Marionette.View{}return e.prototype.template=n,e}.call(this),e.exports={MainBumblrView:o,BumblrDashboardView:s}},40:function(e,t,r){"use strict";r.r(t);var a,s=r(2),o=r.n(s),n=r(56),l=r(4),i=r.n(l),u=r(0),c=r.n(u),h=(r(1),r(51)),d=(r(13),r(55)),p=(r(53),r(84)),b=r.n(p),g=r(66),m=r(7),f=r.n(m);c.a.Radio.channel("global"),c.a.Radio.channel("messages"),c.a.Radio.channel("resources"),a=function(){class e extends c.a.Collection{initialize(){return this.fetch(),this.on("change",this.save,this)}fetch(){var e;return e=JSON.parse(localStorage.getItem(this.local_storage_key))||[],this.set(e)}save(e){return localStorage.setItem(this.local_storage_key,JSON.stringify(this.toJSON()))}}return e.prototype.local_storage_key=null,e}.call(this),console.warn("Use a better model");var w,y,v,_,B,x,k,S,N,P,R,V,C,L,O=class extends u.Model{initialize(){return this.fetch(),this.on("change",this.save,this)}fetch(){return this.set(JSON.parse(localStorage.getItem(this.id)))}save(e,t){return localStorage.setItem(this.id,JSON.stringify(this.toJSON())),i.a.ajax({success:t.success,error:t.error})}destroy(e){return localStorage.removeItem(this.id)}isEmpty(){return f.a.size(this.attributes<=1)}};k=c.a.Radio.channel("global"),w=c.a.Radio.channel("bumblr"),P=k.request("main:app:dbConn","bumblr"),S="//api.tumblr.com/v2",_=function(){class e extends b.a{url(){return`${this.baseURL}/blog/${this.blogName}/posts/photo?api_key=${this.apiKey}`}fetch(e){return e||(e={}),e.data||{},this.state.currentPage,e.dataType="jsonp",super.fetch(e)}parse(e){var t;return console.log("PARSE",e),t=e.response.total_posts,this.state.totalRecords=t,super.parse(e.response.posts)}}return e.prototype.mode="server",e.prototype.full=!0,e.prototype.baseURL=S,e.prototype.state={firstPage:0,pageSize:15},e.prototype.queryParams={pageSize:"limit",offset:function(){return this.state.currentPage*this.state.pageSize}},e}.call(this),y=function(){class e extends c.a.Model{}return e.prototype.baseURL=S,e}.call(this),v=class extends y{url(){return`${this.baseURL}/blog/${this.id}/info?api_key=${this.apiKey}&callback=?`}},B=function(){class e extends O{}return e.prototype.id="bumblr_settings",e}.call(this),V=new B,w.reply("get_app_settings",function(){return V}),N="4mhV8B1YQK6PUA2NW8eZZXVHjU55TPJ3UZnZGrbSoCnqJaxDyH",V.get("consumer_key")||(console.log("saving initial app settings"),V.set("consumer_key",N),V.save()),new g.LoveStore(P,"Blog"),x=function(){class e extends a{addBlog(e){var t,r;return r=`${e}.tumblr.com`,t=new this.model({id:r,name:e}),t.apiKey=V.get("consumer_key"),this.add(t),t.fetch().done(()=>this.save()),t}}return e.prototype.model=v,e}.call(this),w.reply("make-blog-post-collection",function(e){var t,r;return t=V.get("consumer_key"),(r=new _).apiKey=t,r.blogName=e,r}),w.reply("make-pix-collection",function(e){var t,r;return t=V.get("consumer_key"),(r=new _).state={firstPage:0,pageSize:1},r.apiKey=t,r.blogName=e,r}),R=new x({apiKey:V.get("consumer_key")}),w.reply("get-local-blogs",function(){return R}),L=r(149),C=c.a.Radio.channel("bumblr");var I,j,J,$=class extends d.MainController{set_header(e){return i()("#header").text(e)}start(){return this.setupLayoutIfNeeded(),this.set_header("Bumblr"),this.listBlogs()}default_view(){return this.start()}show_mainview(){var e;return e=new L.MainBumblrView,this.layout.showChildView("content",e),Object(h.default)()}showDashboard(){var e;return e=new L.BumblrDashboardView,this.layout.showChildView("content",e),Object(h.default)()}listBlogs(){return this.setupLayoutIfNeeded(),Promise.all([r.e(10),r.e(20)]).then((()=>{var e,t;return e=C.request("get-local-blogs"),t=new(r(171))({collection:e}),this.layout.showChildView("content",t)}).bind(null,r)).catch(r.oe)}viewBlog(e){return this.setupLayoutIfNeeded(),Promise.all([r.e(10),r.e(19)]).then((()=>{var t,a,s;return s=`${e}.tumblr.com`,a=C.request("make-blog-post-collection",s),t=r(170),a.fetch().done(()=>{var e;return e=new t({collection:a}),this.layout.showChildView("content",e),Object(h.default)()})}).bind(null,r)).catch(r.oe)}viewBlogPix(e){return this.setupLayoutIfNeeded(),Promise.all([r.e(10),r.e(19)]).then((()=>{var t,a,s;return s=`${e}.tumblr.com`,a=C.request("make-pix-collection",s),window.pix=a,t=r(169),a.getFirstPage().done(()=>{var e;return e=new t({collection:a}),this.layout.showChildView("content",e),Object(h.default)()})}).bind(null,r)).catch(r.oe)}addNewBlog(){return this.setupLayoutIfNeeded(),Promise.all([r.e(9),r.e(18)]).then((()=>{var e;return e=new(r(168)),this.layout.showChildView("content",e),Object(h.default)()}).bind(null,r)).catch(r.oe)}settingsPage(){return this.setupLayoutIfNeeded(),Promise.all([r.e(9),r.e(17)]).then((()=>{var e;return e=new(0,r(167).default)({model:C.request("get_app_settings")}),this.layout.showChildView("content",e),Object(h.default)()}).bind(null,r)).catch(r.oe)}};Backbone.Radio.channel("global"),I=Backbone.Radio.channel("bumblr"),J=function(){class e extends o.a.AppRouter{}return e.prototype.appRoutes={bumblr:"start","bumblr/settings":"settingsPage","bumblr/dashboard":"showDashboard","bumblr/listblogs":"listBlogs","bumblr/viewblog/:id":"viewBlog","bumblr/addblog":"addNewBlog","bumblr/viewpix/:id":"viewBlogPix"},e}.call(this),j=function(){class e extends n.a{onBeforeStart(){var e;return(e=I.request("get-local-blogs")).fetch(),e.isEmpty()&&["dutch-and-flemish-painters","gkar56","japanesesuburbia","8bitfuture","elfwud","hexeosis","pixel8or","necessary-disorder"].forEach(function(t){return e.addBlog(t)}),super.onBeforeStart(arguments)}}return e.prototype.Controller=$,e.prototype.Router=J,e.prototype.appletEntries=[{label:"Bumblr Menu",menu:[{label:"List Blogs",url:"#bumblr/listblogs",icon:".fa.fa-list"},{label:"Add Blog",url:"#bumblr/addblog",icon:".fa.fa-plus"},{label:"Settings",url:"#bumblr/settings",icon:".fa.fa-gear"}]}],e}.call(this);t.default=j}}]);