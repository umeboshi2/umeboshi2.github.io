(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{101:function(e,t,n){"use strict";n.r(t);var r,i,o,s,c,l,a,u,d,p,f,h,v,m,g,w,y,b,C,q,x,R,N=n(4),V=n.n(N),S=n(1),E=n.n(S),L=n(67);m=E.a.Radio.channel("global"),r=E.a.Radio.channel("ebcsv"),C=m.request("main:app:dbConn","ebcsv"),u=new L.LoveStore(C,"Config"),d=new L.LoveStore(C,"Description"),a=new L.LoveStore(C,"ComicUrl"),p=function(){class e extends E.a.Model{}return e.prototype.loveStore=u,e}.call(this),f=function(){class e extends E.a.Collection{}return e.prototype.loveStore=u,e.prototype.model=p,e}.call(this),v=function(){class e extends E.a.Model{}return e.prototype.loveStore=d,e}.call(this),h=function(){class e extends E.a.Collection{}return e.prototype.loveStore=d,e.prototype.model=v,e}.call(this),c=function(){class e extends E.a.Model{idAttrubute(){return"url"}}return e.prototype.loveStore=a,e}.call(this),l=function(){class e extends E.a.Collection{}return e.prototype.loveStore=a,e.prototype.model=c,e}.call(this),x=new f,R=new h,b=new l,r.reply("get_local_configs",function(){return x}),r.reply("get-config-model",function(){return p}),r.reply("configCollection",function(){return f}),r.reply("get_local_descriptions",function(){return R}),r.reply("get-description-model",function(){return v}),r.reply("descCollection",function(){return h}),r.reply("get_comic_urls",function(){return b}),r.reply("get-comic-url-model",function(){return c}),r.reply("get-comic-url-collection",function(){return l}),s=class extends E.a.Model{initialize(){return this.fetch(),this.on("change",this.save,this)}fetch(){return this.set(JSON.parse(localStorage.getItem(this.id)))}save(e,t){return localStorage.setItem(this.id,JSON.stringify(this.toJSON())),V.a.ajax({success:t.success,error:t.error})}destroy(e){return localStorage.removeItem(this.id)}isEmpty(){return _.size(this.attributes<=1)}},w=["format","location","returnsacceptedoption","duration","quantity","startprice","dispatchtimemax","conditionid"],r.reply("csv-req-fieldnames-local",function(){return w}),g=["postalcode","paymentprofilename","returnprofilename","shippingprofilename","scheduletime"],r.reply("csv-opt-fieldnames-local",function(){return g}),o=class extends s{},function(){class e extends o{}return e.prototype.fieldType="required",e.prototype.fieldNames=w,e}.call(this),function(){class e extends o{}return e.prototype.fieldType="optional",e.prototype.fieldNames=g,e}.call(this),r.reply("get-comic-image-urls",function(){return console.warn("get-comic-image-urls"),new s({id:"comic-image-urls"}).toJSON()}),r.reply("add-comic-image-url",function(e,t){return new s({id:"comic-image-urls"}).set(e,t)}),r.reply("clear-comic-image-urls",function(){var e;return(e=new s({id:"comic-image-urls"})).destroy(),console.log("localStorage",localStorage[e.id])}),i={},r.reply("applet:local:get",function(e){return i[e]}),r.reply("applet:local:set",function(e,t){return i[e]=t}),r.reply("applet:local:delete",function(e){return delete i[e]}),r.reply("set-current-csv-action",function(e){return r.request("applet:local:set","currentCsvAction",e)}),r.reply("get-current-csv-action",function(){return r.request("applet:local:get","currentCsvAction")}),r.reply("set-current-csv-cfg",function(e){return r.request("applet:local:set","currentCsvCfg",e)}),r.reply("get-current-csv-cfg",function(){return r.request("applet:local:get","currentCsvCfg")}),r.reply("set-current-csv-dsc",function(e){return r.request("applet:local:set","currentCsvDsc",e)}),r.reply("get-current-csv-dsc",function(){return r.request("applet:local:get","currentCsvDsc")}),y=function(){class e extends E.a.Model{}return e.prototype.url="/assets/data/superheroes.json",e}.call(this),q=new y,r.reply("get-superheroes-model",function(){return q})},147:function(e,t,n){var r,i,o,s,c,l,a,u,d;i=n(1),d=n(100),n(14),n(73),n(78),n(48),n(49),c=i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),u=new d.Parser({explicitArray:!1,async:!1}),r.reply("get-xmlparser",function(){return u}),l=class extends i.Model{},a=function(){class e extends i.Collection{}return e.prototype.model=l,e}.call(this),o=new a,r.reply("set-comics",function(e){return o.set(e)}),r.reply("get-comics",function(){return o}),s=new a,r.reply("set-all-comics",function(e){return s.set(e)}),r.reply("get-all-comics",function(){return s}),r.reply("parse-all-comics-xml",function(e,t){return u.parseString(e,function(e,n){var i;return(null!=(i=n.comicinfo.comiclist.comic)?i.length:void 0)||(console.warn("Single comic!"),i=[i]),r.request("set-all-comics",forsale),t()})}),r.reply("parse-comics-for-sale",function(e,t){return u.parseString(e,function(e,n){var i,o,s,l,a,u,d,p,f,h;for((null!=(s=n.comicinfo.comiclist.comic)?s.length:void 0)||(s=[s]),l=[],u=[],i=[],a=0,d=s.length;a<d;a++)"For Sale"===(h=(o=s[a]).collectionstatus._)?o.links?l.push(o):i.push(o):"In Collection"===h?u.push(o):(f=`Cannot determine comic status of (${`${(p=o.mainsection).series.displayname} #${p.issue}`})!`,c.request("danger",f));return u.length&&(f=`${u.length} ignored!!`,c.request("warning",f)),l.length||c.request("danger","No comics for sale!"),i.length&&(f=`There was some bad xml, skipped ${i.length} comics.`,c.request("danger",f)),r.request("set-comics",l),t()})}),r.reply("parse-comics-xml",function(e,t){return u.parseString(e,function(e,n){var i;return(null!=(i=n.comicinfo.comiclist.comic)?i.length:void 0)||(i=[i]),r.request("set-comics",i),t()})}),e.exports={}},148:function(e,t,n){var r,i,o,s,c,l=[].indexOf;r=n(1),o=n(78),s=n(48),i=r.Radio.channel("messages"),r.Radio.channel("ebcsv"),c=function(e,t){var n,r,c,a,u;return t.comic,r=t.desc,(u=o.compile(r.get("title"))(t)).length>80&&(c="Title too long.\n",c+=`${u} ----\x3e ${a=u.substring(0,79)}`,i.request("danger",c),u=a),e.Title=u,n=o.compile(r.get("content"))(t),(n=(n=(n=s(n)).split("\r").join("")).split("\n").join("")).length>32700&&(c=`${n.length} characters in description`,i.request("warning",c)),l.call(n,"\n")>=0&&i.request("danger","newline in description"),e.Description=n},e.exports=c},149:function(e,t,n){var r,i,o;i=n(1),n(101),i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),o=function(e,t){var n,i,o;return n=t.comic,o=r.request("get-comic-image-urls"),i=n.links.link.url,t.image_src=o[i].replace("http://","//"),e.PicURL=o[n.links.link.url]},e.exports=o},150:function(e,t,n){var r,i,o,s,c;(i=n(1)).Radio.channel("messages"),r=i.Radio.channel("ebcsv"),o={platinum:{start:1897,end:1937},golden:{start:1938,end:1955},silver:{start:1956,end:1969},bronze:{start:1970,end:1983},copper:{start:1984,end:1991},modern:{start:1992,end:2100}},s=function(e){var t,n;for(n in o)if(e>=(t=o[n]).start&&e<=t.end)return n;return!1},r.reply("get-comic-ages",function(){return o}),r.reply("find-age",function(e){return s(e)}),c=function(e,t){var n,r;return n=s(e),r=[],t.forEach(function(e){if(e.age===n)return r.push(e)}),r},r.reply("get-heroes-by-age",function(e,t){return c(e,t)}),e.exports={}},151:function(e,t,n){var r,i,o,s;i=n(1),n(101),n(150),o=i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),s=function(e,t){var n,i,s,c,l,a,u,d,p,f,h,v,m,g;for(i=t.comic,a=r.request("get-superheroes-model").get("rows"),(g=null!=(v=i.publicationdate)?v.year:void 0)||(g=i.releasedate.year,console.warn("Using releasedate")),g||(console.warn("Bad date for comic",i),o.request("danger",`Bad Date for comic ${i.id}`)),g=parseInt(g.displayname),m=i.mainsection.series.displayname.toLowerCase(),n=r.request("find-age",g),h=void 0,l={},p=0,f=(d=r.request("get-heroes-by-age",g,a)).length;p<f;p++)(u=d[p]).superhero.startsWith("Other ")&&(h=u),l[u.superhero.toLowerCase()]=u;for(c in null==h&&o.request("danger",`No category found for ${n}`),s=h,l)if(m.indexOf(c)>=0){s=l[c];break}return e["*Category"]=s.id},e.exports=s},152:function(e,t){var n;n=function(e,t){var n,r;if(null!=(n=t.comic)?n.isbn:void 0)return 14===(r=n.isbn).length&&(r=r.substring(0,r.length-2)),13===r.length&&(r=r.substring(1,r.length)),e["Product:UPC"]=r},e.exports=n},153:function(e,t,n){var r,i,o;i=n(14),r=n(73),o=function(e,t){var n,o,s,c;return(c=i(e.scheduletime))?(o=(new Date).valueOf()+c,n=new Date(o),s="yyyy-mm-dd HH:MM:ss",e.scheduletime=r(n,s)):e.scheduletime=""},e.exports=o},154:function(e,t){var n;n=function(e,t){var n,r;if(null!=(n=t.comic)?n.currentprice:void 0){for(r=n.currentprice;r.startsWith("$");)r=r.substring(1,r.length);return e.startprice=r}},e.exports=n},155:function(e,t,n){var r,i,o,s,c,l,a,u;i=n(1),n(100),n(14),n(73),n(78),n(48),a=n(49).default,i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),s=["Title","PicURL","Description","Product:EAN","Product:UPC","Product:ISBN","*Category"],l=["format","location","returnsacceptedoption","duration","quantity","startprice","dispatchtimemax","conditionid"],r.reply("csv-req-fieldnames",function(){return l}),c=["postalcode","paymentprofilename","returnprofilename","shippingprofilename","scheduletime"],r.reply("csv-opt-fieldnames",function(){return c}),u=function(){var e,t,n,r,i,o,u,d;for(t={action:"*Action"},n=0,o=l.length;n<o;n++)t[e=l[n]]=`*${a(e)}`;for(r=0,u=c.length;r<u;r++)t[e=c[r]]=e;for(i=0,d=s.length;i<d;i++)t[e=s[i]]=e;return t},r.reply("create-csv-header",function(){return create-csv-header()}),o=u(),r.reply("get-csv-header",function(){return o}),r.reply("grouped-csv-fields",function(){return{ReqFieldNames:l,OptFieldNames:c,EbayFields:s}}),e.exports={}},164:function(e,t){},166:function(e,t){},172:function(e,t,n){var r,i,o,s,c,l,a,u,d,p,f;i=n(1),n(100),n(14),n(73),n(78),n(48),n(49),n(155),p=n(154),d=n(153),u=n(152),l=n(151),a=n(149),f=n(148),i.Radio.channel("messages"),r=i.Radio.channel("ebcsv"),c=r.request("grouped-csv-fields"),o=function(e){var t,n;return n={},t=e.cfg.get("content"),n.action=e.action,c.ReqFieldNames.forEach(function(e){return n[e]=t[e]}),c.OptFieldNames.forEach(function(e){return n[e]=t[e]}),c.EbayFields.forEach(function(e){return n[e]=""}),n},s=function(e){var t,n,r;return t=e.comic,e.cfg.get("content"),(r=o(e)).quantity!==t.quantity&&(r.quantity=t.quantity),p(r,e),d(r,e),u(r,e),l(r,e),a(r,e),(null!=(n=t.mainsection)?n.plot:void 0)&&(t.mainsection.plot=t.mainsection.plot.split("<br>").join("\n"),t.mainsection.plot=t.mainsection.plot.split("<BR>").join("\n")),f(r,e),r},r.reply("create-csv-row-object",function(e){return s(e)}),e.exports={}},173:function(e,t,n){n(172),n(147)},42:function(e,t,n){"use strict";n.r(t);var r,i,o,s,c,l,a,u=n(1),d=n.n(u),p=n(3),f=n.n(p),h=n(61),v=(n(4),n(2)),m=n.n(v),g=n(14),w=n.n(g),y=n(55),_=n(69),b=n(68),C=n(13),q=n(54),x=d.a.Radio.channel("ebcsv"),R=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};({MainController:r}=n(60)),d.a.Radio.channel("global"),i=d.a.Radio.channel("messages"),d.a.Radio.channel("resources"),o=d.a.Radio.channel("navbar"),s={id:"addcfg",label:"Create Cfg",url:"#ebcsv/configs/add",icon:".fa.fa-plus"},c={id:"adddsc",label:"Create Description",url:"#ebcsv/descriptions/add",icon:".fa.fa-plus"},function(){class e extends d.a.Marionette.View{regions(){var e;return(e=new b.a({el:"#main-content"})).slide_speed=w()(".01s"),{content:e,toolbar:"#main-toolbar"}}}return e.prototype.behaviors={ShowInitialEmptyContent:{behaviorClass:_.a}},e.prototype.template=m.a.renderable(function(e){return m.a.div(".col-sm-12",function(){return m.a.div(".row",function(){return m.a.div("#main-toolbar.col-sm-10.col-sm-offset-1")}),m.a.div(".row",function(){return m.a.div("#main-content.col-sm-10.col-sm-offset-1")})})}),e}.call(this),a=new d.a.Collection([]),x.reply("get-toolbar-entries",function(){return a}),l="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",function(){class e extends y.default{}return e.prototype.options={entryTemplate:m.a.renderable(function(e){var t;return t={style:l},m.a.span(t,function(){return m.a.i(e.icon),m.a.text(" "),m.a.text(e.label)})})},e}.call(this);var N,V,S,E=class e extends r{constructor(){super(...arguments),this._showMainView=this._showMainView.bind(this),this._show_create_csv_view=this._show_create_csv_view.bind(this),this._show_preview_csv_view=this._show_preview_csv_view.bind(this),this.create_csv=this.create_csv.bind(this)}_showMainView(){return R(this,e),Promise.all([n.e(12),n.e(13),n.e(14),n.e(33)]).then((()=>{var e,t;return e=x.request("get-comics"),t=new(n(203))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_show_create_csv_view(){return R(this,e),Promise.all([n.e(12),n.e(13),n.e(14),n.e(32)]).then((()=>{var e,t;return e=x.request("get-comics"),t=new(n(202))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_show_preview_csv_view(){return R(this,e),Promise.all([n.e(12),n.e(31)]).then((()=>{var e,t;return e=x.request("get-comics"),t=new(n(201))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}_needComicsView(e){return x.request("get-comics").length?e():Object(C.default)("#ebcsv/xml/upload")}create_csv(){var t,n;return R(this,e),this.setupLayoutIfNeeded(),t=x.request("get_local_configs"),n=x.request("get_local_descriptions"),t.fetch().then(()=>n.fetch().then(()=>this._needComicsView(this._show_create_csv_view)))}preview_csv(){var e,t,n;if(this.setupLayoutIfNeeded(),e=x.request("get-current-csv-cfg"),t=x.request("get-current-csv-dsc"),n=x.request("get-superheroes-model"),void 0!==e)return e.fetch().then(()=>t.fetch().then(()=>n.fetch().then(()=>this._needComicsView(this._show_preview_csv_view))));Object(C.default)("#ebcsv")}main_view(){return this.setupLayoutIfNeeded(),this._needComicsView(this._showMainView)}upload_xml(){return this.setupLayoutIfNeeded(),Promise.all([n.e(12),n.e(30)]).then((()=>{var e,t;return e=x.request("get-comics"),t=new(n(200))({collection:e}),this.layout.showChildView("content",t)}).bind(null,n)).catch(n.oe)}view_cached_comics(){return this.setupLayoutIfNeeded(),Promise.all([n.e(12),n.e(29)]).then((()=>{var e;return e=new(n(199)),this.layout.showChildView("content",e)}).bind(null,n)).catch(n.oe)}_setCfgEntries(){return o.request("get-entries","view").set([s])}list_configs(){return this.setupLayoutIfNeeded(),this._setCfgEntries(),n.e(28).then((()=>{var e;return(e=x.request("get_local_configs")).fetch().done(t=>{var r;return console.log("ROWS",t,e),r=new(n(198))({collection:e}),this.layout.showChildView("content",r)})}).bind(null,n)).catch(n.oe)}add_new_config(){return this.setupLayoutIfNeeded(),this._setCfgEntries(),Promise.all([n.e(11),n.e(17)]).then((()=>{var e;return e=new(n(197).NewFormView),this.layout.showChildView("content",e),Object(q.default)()}).bind(null,n)).catch(n.oe)}view_config(e){return this.setupLayoutIfNeeded(),this._setCfgEntries(),Promise.all([n.e(11),n.e(27)]).then((()=>{var t,r,i;return t=n(196),r=x.request("get_local_configs"),(i=new r.model({id:e})).fetch().done(e=>{var n;return n=new t({model:i}),this.layout.showChildView("content",n),Object(q.default)()})}).bind(null,n)).catch(n.oe)}edit_config(e){return this.setupLayoutIfNeeded(),this._setCfgEntries(),Promise.all([n.e(11),n.e(17)]).then((()=>{var t,r,i;return t=n(197),r=x.request("get_local_configs"),(i=new r.model({id:e})).fetch().done(e=>{var n;return n=new t.EditFormView({model:i}),this.layout.showChildView("content",n),Object(q.default)()})}).bind(null,n)).catch(n.oe)}_setDscEntries(){return o.request("get-entries","view").set([c])}list_descriptions(){return this.setupLayoutIfNeeded(),this._setDscEntries(),n.e(26).then((()=>{var e,t;return(t=(e=x.request("get_local_descriptions")).fetch()).done(t=>{var r;return r=new(n(195))({collection:e}),this.layout.showChildView("content",r)}),t.fail(function(){return i.request("danger","Failed to get descriptions")})}).bind(null,n)).catch(n.oe)}add_new_description(){return this.setupLayoutIfNeeded(),this._setDscEntries(),Promise.all([n.e(11),n.e(15),n.e(16)]).then((()=>{var e;return e=new(n(194).NewFormView),this.layout.showChildView("content",e),Object(q.default)()}).bind(null,n)).catch(n.oe)}view_description(e){return this.setupLayoutIfNeeded(),this._setDscEntries(),n.e(25).then((()=>{var t,r,i;return t=n(193),r=x.request("get_local_descriptions"),(i=new r.model({id:e})).fetch().done(e=>{var n;return n=new t({model:i}),this.layout.showChildView("content",n),Object(q.default)()})}).bind(null,n)).catch(n.oe)}edit_description(e){var t;return this.setupLayoutIfNeeded(),this._setDscEntries(),t=x.request("get_local_descriptions"),Promise.all([n.e(11),n.e(15),n.e(16)]).then((()=>{var r,i;return r=n(194),t=x.request("get_local_descriptions"),(i=new t.model({id:e})).fetch().done(e=>{var t;return t=new r.EditFormView({model:i}),this.layout.showChildView("content",t),Object(q.default)()})}).bind(null,n)).catch(n.oe)}};n(101),n(173),d.a.Radio.channel("global"),d.a.Radio.channel("resources"),S=[{id:"main",label:"Main View",url:"#ebcsv",icon:".fa.fa-eye"},{id:"cfglist",label:"Configs",url:"#ebcsv/configs/list",icon:".fa.fa-list"},{id:"dsclist",label:"Descriptions",url:"#ebcsv/descriptions/list",icon:".fa.fa-list"},{id:"uploadxml",label:"Upload CLZ/XML",url:"#ebcsv/xml/upload",icon:".fa.fa-upload"},{id:"mkcsv",label:"Create CSV",url:"#ebcsv/csv/create",icon:".fa.fa-cubes"},{id:"cached",label:"Cached Images",url:"#ebcsv/clzpage",icon:".fa.fa-image"},{id:"addcfg",label:"Create Cfg",url:"#ebcsv/configs/add",icon:".fa.fa-plus"}],V=function(){class e extends f.a.AppRouter{}return e.prototype.appRoutes={ebcsv:"main_view","ebcsv/xml/upload":"upload_xml","ebcsv/csv/create":"create_csv","ebcsv/csv/preview":"preview_csv","ebcsv/clzpage":"view_cached_comics","ebcsv/configs":"list_configs","ebcsv/configs/list":"list_configs","ebcsv/configs/add":"add_new_config","ebcsv/configs/view/:name":"view_config","ebcsv/configs/edit/:name":"edit_config","ebcsv/descriptions":"list_descriptions","ebcsv/descriptions/list":"list_descriptions","ebcsv/descriptions/add":"add_new_description","ebcsv/descriptions/view/:name":"view_description","ebcsv/descriptions/edit/:name":"edit_description"},e}.call(this),N=function(){class e extends h.a{}return e.prototype.Controller=E,e.prototype.Router=V,e.prototype.appletEntries=[{label:"Ebcsv Menu",menu:S}],e.prototype.state={currentCsvAction:void 0,currentCsvConfig:void 0,currentCsvDsc:void 0},e}.call(this);t.default=N}}]);