(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{160:function(e,t,n){var i,o,r,a,s,l;n(3),i=n(1),n(2),n(40),l=n(0),n(11),({make_field_input:a,make_field_select:s}=n(38)),n(55),o=n(73),i.Radio.channel("global"),i.Radio.channel("messages"),i.Radio.channel("ebcsv"),r=function(){class e extends i.Marionette.View{onRender(){var e;return e=new o({collection:this.collection}),this.showChildView("body",e)}}return e.prototype.regions={body:".body"},e.prototype.template=l.renderable(function(e){return l.div(".listview-header",function(){return l.text("CLZ XML to EBay File Exchange CSV")}),l.div(".body")}),e}.call(this),e.exports=r},53:function(e,t,n){var i,o,r,a;n(1),o=n(2),r=n(40),a=n(43),i=function(){class e extends o.Behavior{ui(){return{list:this.getOption("listContainer")}}setMasonry(){var e,t;return e=this.getOption("listContainer"),t=this.getOption("masonryOptions"),this.view.masonry=new r(e,t)}setMasonryLayout(){var e,t;return t=this.getOption("masonryOptions"),e=this.$(t.itemSelector),a(e,()=>(this.view.masonry.reloadItems(),this.view.masonry.layout()))}onBeforeDestroy(){return this.view.masonry.destroy()}onDomRefresh(){var e;if(this.setMasonry(),this.setMasonryLayout(),null!=(e=this.view)?e.afterDomRefresh:void 0)return this.view.afterDomRefresh()}}return e.prototype.options={listContainer:".list-container",channel:"global",masonryOptions:{gutter:1,isInitLayout:!1,itemSelector:".item",columnWidth:10,horizontalOrder:!0}},e.prototype.regions={list:"@ui.list"},e}.call(this),e.exports=i},54:function(e,t,n){var i,o,r,a,s,l,c,u,d,m;i=n(1),l=n(2),m=n(0),({make_field_input:c,make_field_select:u}=n(38)),({modal_close_button:d}=n(41)),s=i.Radio.channel("global"),i.Radio.channel("messages"),i.Radio.channel("ebcsv"),o=s.request("main:app:BaseModalView"),a=function(){class e extends o{}return e.prototype.template=m.renderable(function(e){return e.mainsection,m.div(".modal-dialog",function(){return m.div(".modal-content",function(){return m.div(".modal-body",function(){return m.img({src:e.image_src})}),m.div(".modal-footer",function(){return m.ul(".list-inline",function(){return"btn.btn-default.btn-sm",m.li("#close-modal",function(){return d("Close","check")})})})})})}),e}.call(this),r=class extends l.Behavior{onShowImageModal(){var e;return e=new a({model:this.view.model}),s.request("show-modal",e)}},e.exports=r},55:function(e,t,n){var i,o,r,a,s,l,c,u,d,m,h,p,f,g,_;i=n(3),r=n(1),n(2),n(40),_=n(0),n(11),({make_field_input:p,make_field_select:f}=n(38)),({modal_close_button:g}=n(41)),d=n(74),c=n(54),console.log("HasImageModal",c),m=r.Radio.channel("global"),h=r.Radio.channel("messages"),o=r.Radio.channel("ebcsv"),a=m.request("main:app:BaseModalView"),console.log("BaseModalView",a),u=function(){class e extends a{}return e.prototype.template=_.renderable(function(e){return e.mainsection,_.div(".modal-dialog.modal-lg",function(){return _.div(".modal-content",function(){return _.div(".modal-body",function(){var t;return t=e.src.replace("http://","//"),_.iframe({style:"width:97%;height:75vh;",src:t})}),_.div(".modal-footer",function(){return _.ul(".list-inline",function(){return"btn.btn-default.btn-sm",_.li("#close-modal",function(){return g("Close","check")})})})})})}),e}.call(this),l=function(){class e extends r.Marionette.View{onDomRefresh(){return this.trigger("show:image")}}return e.prototype.template=_.renderable(function(e){var t;return t=(t=e.image_src.replace("/lg/","/sm/")).replace("http://","//"),_.img({src:t})}),e.prototype.ui={image:"img"},e.prototype.triggers={"click @ui.image":"show:image:modal"},e.prototype.behaviors=[c],e}.call(this),s=function(){class e extends r.Marionette.View{mouse_enter_item(e){return this.ui.info_btn.show()}mouse_leave_item(e){return this.ui.info_btn.hide()}show_comic_json(e){var t;if("A"!==e.target.tagName)return t=new d({model:this.model}),m.request("show-modal",t)}show_comic_page(e){var t,n;if(e.preventDefault(),"A"===(t=e.target).tagName)return n=new u({model:new r.Model({src:t.href})}),m.request("show-modal",n)}onDomRefresh(){var e,t,n;return this.ui.info_btn.hide(),t=this.model.get("links").link.url,(n=o.request("get-comic-image-urls"))[t]?(e=new r.Model({image_src:n[t],url:t}),this._show_comic_image(e,!1)):t?this._get_comic_data(t,this._parse_html):void 0}_get_comic_data(e,t){var n;return console.log("_get_comic_data",e),new URL(e),(n=r.ajax({type:"GET",dataType:"html",url:`//cors-anywhere.herokuapp.com/${e}`})).done(function(){return t(e,n.responseText)}),n.fail(function(){return h.request("warning","Couldn't get the info")})}_parse_html(e,t){var n,r,a,s,l,c;for(c=[],a=0,l=(n=i.parseHTML(t)).length;a<l;a++)"LINK"===(r=n[a]).tagName&&"image_src"===r.rel&&c.push(r);return c.length>1&&h.request("warning","Too many links for this comic."),s=c[0].href,o.request("add-comic-image-url",e,s)}_set_local_images_url(e){return e.get("url"),e.get("image_src")}_show_comic_image(e,t=!0){var n;return t&&this._set_local_images_url(e),n=new l({model:e}),this.showChildView("image",n)}show_comic(){var e,t,n,i;return t=this.model.get("links"),i=t.link.url,new URL(i),(n=(e=o.request("clzpage-collection")).fetch({data:{where:{url:i}}})).fail(function(){var e;return e="There was a problem talking to the server",h.request("warning",e)}),n.done(()=>{if(e.length>1&&h.request("warning",`${i} is not unique!`),!e.length)return this._get_comic_data(i,this._add_comic_to_db)})}get_comic_data(e){var t,n;return t=new URL(e),(n=r.ajax({type:"GET",dataType:"html",url:`/clzcore${t.pathname}`})).done(()=>{var e;return e=new r.Marionette.View({template:n.responseText}),this.showChildView("info",e)}),n.fail(function(){return h.request("warning","Couldn't get the info")})}}return e.prototype.template=_.renderable(function(e){var t;return t=e.mainsection,_.div(".item.listview-list-entry.thumbnail.col-sm-2",function(){return _.div(".comic-image",function(){return _.i(".fa.fa-spinner.fa-spin"),_.text("loading")}),_.div(".caption",function(){var n,i;return _.span(function(){return _.i(".info-button.fa.fa-info.fa-pull-left.btn.btn-default.btn-sm"),_.h5({style:"text-overflow: ellipsis;"},`${t.series.displayname} #${e.issue}`)}),n=(n=(null!=t?t.title:void 0)||(null!=e&&null!=(i=e.edition)?i.displayname:void 0))||_.strong("UNTITLED"),_.a(".clz-link",{href:`${e.links.link.url}`,target:"_blank"},n)})})}),e.prototype.ui={info_btn:".info-button",clz_link:".clz-link",item:".item",image:".comic-image"},e.prototype.regions={image:"@ui.image"},e.prototype.events={"click @ui.info_btn":"show_comic_json","click @ui.clz_link":"show_comic_page","mouseenter @ui.item":"mouse_enter_item","mouseleave @ui.item":"mouse_leave_item"},e.prototype.childViewTriggers={"show:image":"show:image"},e}.call(this),e.exports=s},73:function(e,t,n){var i,o,r,a,s,l,c,u,d,m;n(3),i=n(1),n(2),n(40),n(43),m=n(0),s=n(44),n(11),({make_field_input:u,make_field_select:d}=n(38)),r=n(55),c=n(53),i.Radio.channel("global"),i.Radio.channel("messages"),i.Radio.channel("ebcsv"),l=class extends c{onChildviewShowImage(e){return this.setMasonryLayout()}},o=function(){class e extends i.Marionette.CollectionView{}return e.prototype.childView=r,e.prototype.emptyView=s,e.prototype.childViewTriggers={"show:image":"show:image"},e}.call(this),a=function(){class e extends i.Marionette.View{ui(){return{list:this.getOption("listContainer")}}onRender(){var e;return e=new o({collection:this.collection}),this.showChildView("list",e)}}return e.prototype.options={listContainer:"#comiclist-container"},e.prototype.regions={list:"@ui.list"},e.prototype.behaviors={HasLateImages:{behaviorClass:l,listContainer:"#comiclist-container",masonryOptions:{gutter:1,isInitLayout:!1,itemSelector:".item",columnWidth:10,horizontalOrder:!1}}},e.prototype.template=m.renderable(function(e){return m.div("#comiclist-container")}),e}.call(this),e.exports=a},74:function(e,t,n){var i,o,r,a,s,l;n(6),i=n(1),n(2),l=n(0),r=n(84),n(83),n(42),({modal_close_button:s}=n(41)),o=n(19).default,i.Radio.channel("global"),i.Radio.channel("ebcsv"),a=function(){class e extends i.Marionette.View{expand_view(){return this.expanded_view?(this.json_view.collapse(!0),this.expanded_view=!1,this.ui.expand_btn.text("Expand")):(this.json_view.expand(!0),this.expanded_view=!0,this.ui.expand_btn.text("Collapse"))}onDomRefresh(){return console.log("onDomRefresh->jsonview"),this.expanded_view=!1,this.json_view=new r(this.model.toJSON()),this.ui.body.prepend(this.json_view.dom)}}return e.prototype.behaviors=[o],e.prototype.template=l.renderable(function(e){var t;return t=e.mainsection,l.div(".modal-dialog",function(){return l.div(".modal-content",function(){return l.h3(`${t.series.displayname} #${t.issue}`),l.div(".modal-body",function(){return l.div(".expand-button.btn.btn-default","Expand"),l.div(".panel")}),l.div(".modal-footer",function(){return l.ul(".list-inline",function(){return"btn.btn-default.btn-sm",l.li("#close-modal",function(){return s("Close","check")})})})})})}),e.prototype.ui={body:".panel",expand_btn:".expand-button",close_btn:"#close-modal div"},e.prototype.events={"click @ui.expand_btn":"expand_view"},e}.call(this),e.exports=a}}]);