(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{196:function(e,t,n){var o,a,r,i,d,s,l,c,u,h,p,f,w=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};o=n(4),r=n(2),n(3),c=n(1),h=n(100),n(115),n(114),d=r.Radio.channel("global"),a=r.Radio.channel("tvmaze"),r.Radio.channel("hubby"),f=n(0),s=f.renderable(function(){return f.div(".listview-header","Episodes"),f.div(".loading",function(){return f.h2(function(){return f.i(".fa.fa-spinner.fa-spin"),f.text("Loading Episodes")})}),f.div(".maincalendar")}),p=function(e,t){return e.url=`#tvmaze/shows/view/${e.showId}`,t.css({cursor:"pointer","font-size":"0.9em","font-family":"Rambla"})},u=function(e){var t,n;return n=o(".loading"),t=o(".fc-toolbar"),e?(n.show(),t.hide()):(n.hide(),t.show())},l=function(e,t,n,o){var r,i,s,l,u,p,f;return a.request("get-local-episode-model"),r=a.request("get-local-episode-collection"),f=(i=d.request("main:app:dbConn","tvmaze")).getSchema().table("TVMazeEpisode"),l=[],window.startMoment=e,p=e.toDate(),s=t.toDate(),l.push(f.airdate.gte(e)),l.push(f.airdate.lte(t)),u=i.select().from(f).where(c.op.and(f.airdate.gte(e.toDate()),f.airdate.lte(t.toDate()))),console.log("Q",u,p,s),u=u.exec(),console.log("Q",u),u.then(function(e){var t,n,a;return console.log("RESULTS",e),(t=new r).set(e),n=t.toJSON(),console.log("collection",t),a=[],n.forEach(function(e){var t,n,o;return t=h(e.airdate),o=e.runtime||30,n={id:e.id,showId:e.show_id,title:e.name,allDay:!1,start:t,end:t.add(o,"minutes"),url:`#tvmaze/shows/view/${e.show_id}`},a.push(n)}),o(a)})},i=function(){class e extends r.Marionette.View{constructor(){super(...arguments),this.calendarViewRender=this.calendarViewRender.bind(this)}onBeforeDestroy(){return this.ui.calendar.fullCalendar("destroy"),console.log("calendar destroyed")}calendarViewRender(t,n){return w(this,e),a.request("maincalendar:set-date",this.ui.calendar)}onDomRefresh(){var e,t;return e=(e=>{var t,n;return this.options.minicalendar?(t={layout:this.options.layout,region:"episode",id:e.id},a.request("view-episode",t)):(n=e.url,console.log("EVENT URL",e,n),r.history.navigate(n,{trigger:!0}))}),t=a.request("maincalendar:get-date"),this.ui.calendar.fullCalendar({defaultDate:t,header:{left:"prevYear, nextYear",center:"title",right:"prev, next"},theme:!1,defaultView:"month",eventSources:[{events:l}],eventRender:p,viewRender:this.calendarViewRender,loading:u,eventClick:e}),console.log("we should either be fetching events, or refetching")}}return e.prototype.template=s,e.prototype.ui={calendar:".maincalendar",loading:".loading",header:".fc-toolbar",daytop:".fc-day-top"},e.prototype.options={minicalendar:!1,layout:!1},e}.call(this),e.exports=i}}]);
//# sourceMappingURL=tvmaze-view-calendar-5db0b08acd95b3c229d3.js.map